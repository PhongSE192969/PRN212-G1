<Window x:Class="BubbleTeaApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Hệ Thống Quản Lý Đơn Hàng Trà Sữa" 
        Height="700" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">

    <Window.Resources>
        <!-- Style cho Button -->
        <Style x:Key="ModernButton" TargetType="Button">
            <Setter Property="Background" Value="#FF6B35"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="5" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E85A2C"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#CCCCCC"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="ProductCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ToppingCheckBox" TargetType="CheckBox">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#FF6B35" Padding="20,15">
            <Grid>
                <StackPanel>
                    <TextBlock Text="🧋 HỆ THỐNG ĐẶT HÀNG TRÀ SỮA" 
                               FontSize="24" FontWeight="Bold" 
                               Foreground="White"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2.5*"/>
                <ColumnDefinition Width="10"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - Products -->
            <Border Grid.Column="0" Background="White" CornerRadius="10" Padding="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Search Box -->
                    <TextBlock Grid.Row="0" Text="DANH SÁCH SẢN PHẨM" 
                               FontSize="18" FontWeight="Bold" 
                               Foreground="#FF6B35" Margin="0,0,0,10"/>

                    <TextBox Grid.Row="1" 
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             FontSize="14" Padding="10" Margin="0,0,0,10"
                             BorderBrush="#FF6B35" BorderThickness="2">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Background">
                                            <Setter.Value>
                                                <VisualBrush Stretch="None" AlignmentX="Left">
                                                    <VisualBrush.Visual>
                                                        <TextBlock Text="🔍 Tìm kiếm sản phẩm..." 
                                                                   Foreground="#999" 
                                                                   Margin="5,0,0,0"/>
                                                    </VisualBrush.Visual>
                                                </VisualBrush>
                                            </Setter.Value>
                                        </Setter>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <!-- Products List -->
                    <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding FilteredProducts}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource ProductCard}" 
                                            Width="200" Height="180"
                                            Cursor="Hand">
                                        <Border.InputBindings>
                                            <MouseBinding MouseAction="LeftClick" 
                                                        Command="{Binding DataContext.SelectProductCommand, 
                                                        RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"/>
                                        </Border.InputBindings>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Icon -->
                                            <TextBlock Grid.Row="0" Text="🧋" 
                                                       FontSize="48" 
                                                       HorizontalAlignment="Center"
                                                       Margin="0,5"/>

                                            <!-- Product Name -->
                                            <TextBlock Grid.Row="1" 
                                                       Text="{Binding Name}" 
                                                       FontSize="14" FontWeight="Bold"
                                                       TextWrapping="Wrap"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       TextAlignment="Center"
                                                       Margin="5"/>

                                            <!-- Category -->
                                            <TextBlock Grid.Row="2" 
                                                       Text="{Binding Category}" 
                                                       FontSize="11"
                                                       Foreground="#666"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,2"/>

                                            <!-- Price -->
                                            <TextBlock Grid.Row="3" 
                                                       FontSize="16" FontWeight="Bold"
                                                       Foreground="#FF6B35"
                                                       HorizontalAlignment="Center"
                                                       Margin="0,5,0,0">
                                                <TextBlock.Text>
                                                    <MultiBinding StringFormat="{}{0:N0} VNĐ">
                                                        <Binding Path="Price"/>
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>

            <!-- Right Panel - Order Details & Cart -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Order Details -->
                <Border Grid.Row="0" Background="White" CornerRadius="10" Padding="15" Margin="0,0,0,10">
                    <StackPanel>
                        <TextBlock Text="CHI TIẾT ĐƠN HÀNG" 
                                   FontSize="18" FontWeight="Bold" 
                                   Foreground="#FF6B35" Margin="0,0,0,10"/>

                        <!-- Selected Product -->
                        <TextBlock Text="Sản phẩm đã chọn:" FontWeight="SemiBold" Margin="0,5"/>
                        <TextBlock Text="{Binding SelectedProduct.Name, FallbackValue='Chưa chọn sản phẩm'}" 
                                   FontSize="14" Margin="0,2,0,10"
                                   Foreground="#FF6B35" FontWeight="Bold"/>

                        <!-- Quantity -->
                        <TextBlock Text="Số lượng:" FontWeight="SemiBold" Margin="0,5"/>
                        <StackPanel Orientation="Horizontal" Margin="0,5">
                            <Button Content="−" Width="40" Height="35" FontSize="18"
                                    Command="{Binding DecreaseQuantityCommand}"
                                    Style="{StaticResource ModernButton}"/>
                            <TextBox Text="{Binding Quantity, Mode=TwoWay}" 
                                     Width="60" Height="35" FontSize="16"
                                     TextAlignment="Center" 
                                     VerticalContentAlignment="Center"
                                     Margin="5,0"/>
                            <Button Content="+" Width="40" Height="35" FontSize="18"
                                    Command="{Binding IncreaseQuantityCommand}"
                                    Style="{StaticResource ModernButton}"/>
                        </StackPanel>

                        <!-- Toppings -->
                        <TextBlock Text="Topping (chọn nhiều):" FontWeight="SemiBold" Margin="0,10,0,5"/>
                        <ScrollViewer MaxHeight="150" VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding AvailableToppings}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <CheckBox Style="{StaticResource ToppingCheckBox}"
                                                  IsChecked="{Binding IsSelected, Mode=TwoWay}">
                                            <CheckBox.Content>
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding Name}" Width="120"/>
                                                    <TextBlock FontWeight="Bold" Foreground="#FF6B35">
                                                        <TextBlock.Text>
                                                            <MultiBinding StringFormat="{}+{0:N0}đ">
                                                                <Binding Path="Price"/>
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                    </TextBlock>
                                                </StackPanel>
                                            </CheckBox.Content>
                                        </CheckBox>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Add to Cart Button -->
                        <Button Content="➕ THÊM VÀO GIỎ HÀNG" 
                                Margin="0,15,0,0"
                                Height="40" FontSize="14"
                                Command="{Binding AddToCartCommand}"
                                Style="{StaticResource ModernButton}"/>
                    </StackPanel>
                </Border>

                <!-- Shopping Cart -->
                <Border Grid.Row="1" Background="White" CornerRadius="10" Padding="15">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                            <TextBlock Text="GIỎ HÀNG" 
                                       FontSize="18" FontWeight="Bold" 
                                       Foreground="#FF6B35"/>
                            <TextBlock Text="{Binding CartItems.Count, StringFormat=' ({0})'}" 
                                       FontSize="16" Foreground="#666"
                                       VerticalAlignment="Bottom" Margin="5,0,0,2"/>
                        </StackPanel>

                        <!-- Cart Items -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                            <ItemsControl ItemsSource="{Binding CartItems}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="#EEE" BorderThickness="0,0,0,1" 
                                                Padding="0,10" Margin="0,5">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>

                                                <TextBlock Grid.Row="0" 
                                                           Text="{Binding Product.Name}" 
                                                           FontWeight="Bold" FontSize="14"/>

                                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,3">
                                                    <TextBlock Text="Số lượng: " Foreground="#666"/>
                                                    <TextBlock Text="{Binding Quantity}" FontWeight="SemiBold"/>
                                                </StackPanel>

                                                <TextBlock Grid.Row="2" 
                                                           Text="{Binding ToppingsDisplay}" 
                                                           FontSize="12" Foreground="#666"
                                                           Margin="0,2"/>

                                                <Grid Grid.Row="3" Margin="0,5,0,0">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Grid.Column="0" 
                                                               FontSize="14" FontWeight="Bold"
                                                               Foreground="#FF6B35">
                                                        <TextBlock.Text>
                                                            <MultiBinding StringFormat="{}{0:N0} VNĐ">
                                                                <Binding Path="TotalPrice"/>
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                    </TextBlock>

                                                    <Button Grid.Column="1" 
                                                            Content="🗑️" 
                                                            Width="30" Height="30"
                                                            Background="#DC3545"
                                                            Command="{Binding DataContext.RemoveFromCartCommand, 
                                                                    RelativeSource={RelativeSource AncestorType=Window}}"
                                                            CommandParameter="{Binding}"
                                                            Style="{StaticResource ModernButton}"/>
                                                </Grid>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Total Amount -->
                        <Border Grid.Row="2" Background="#FFF8DC" 
                                Padding="15" CornerRadius="8" Margin="0,10,0,0"
                                BorderBrush="#FF6B35" BorderThickness="2">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" 
                                           Text="TỔNG CỘNG:" 
                                           FontSize="18" 
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" 
                                           FontSize="24" 
                                           FontWeight="Bold"
                                           Foreground="#FF6B35"
                                           VerticalAlignment="Center">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0:N0} VNĐ">
                                            <Binding Path="TotalAmount"/>
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Grid>
                        </Border>

                        <!-- Checkout Buttons -->
                        <StackPanel Grid.Row="3" Margin="0,10,0,0">
                            <Button Content="💳 THANH TOÁN" 
                                    Height="50" 
                                    FontSize="16" 
                                    FontWeight="Bold"
                                    Margin="0,0,0,8"
                                    Command="{Binding CheckoutCommand}"
                                    Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background" Value="#28A745"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                            CornerRadius="8" 
                                                            Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                        VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#218838"/>
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter Property="Background" Value="#CCCCCC"/>
                                                <Setter Property="Foreground" Value="#666666"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                            
                            <Button Content="🗑️ XÓA GIỎ HÀNG" 
                                    Height="40" 
                                    FontSize="14"
                                    Command="{Binding ClearCartCommand}"
                                    Cursor="Hand">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Background" Value="#DC3545"/>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}" 
                                                            CornerRadius="8" 
                                                            Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" 
                                                                        VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#C82333"/>
                                            </Trigger>
                                            <Trigger Property="IsEnabled" Value="False">
                                                <Setter Property="Background" Value="#CCCCCC"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>
